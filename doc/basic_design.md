# プレゼンフィードバックエージェント 基本設計

## 概要
プレゼンテーション音声を分析し、発表の仕方について多角的なフィードバックを提供するマルチエージェントシステム。

## 要件

### インプット
- **Phase 1**: 音声ファイル（MP3, WAV, M4A等）
- **Phase 2**: 動画ファイル（MP4等）→ 音声抽出して処理
- **Phase 3**: スライド資料（PDF等）との統合分析

**設計方針**: 音声ファイルをベースに設計することで、動画対応時も音声抽出処理を追加するだけで拡張可能。

### アウトプット
発表の仕方に関する観点でのフィードバック:
- 話すスピード
- 話の流れ・構成
- 話の抑揚・トーン
- よかった点
- 改善点

※スコアリングも検討可能だが、定性的なフィードバック優先

## マルチエージェント構成案

### Phase 1: 音声ベースの3エージェント構成

#### 1. 監督者エージェント (Orchestrator)
**役割**: 全体の統括・最終レポート作成
- 各サブエージェントからのフィードバックを統合
- 優先度付けと総合評価
- 最終レポートの生成（よかった点・改善点）

#### 2. 音声特徴分析エージェント (Speech Analyzer)
**役割**: 音声の物理的特徴の分析
- **話すスピード**:
  - 発話速度（words per minute）の計測
  - 速すぎる/遅すぎる箇所の検出
- **間（ポーズ）の分析**:
  - 適切な間の取り方
  - 「えー」「あのー」などのフィラーワード検出・カウント
- **音量・明瞭さ**:
  - 声の大きさの一貫性
  - 聞き取りやすさ
- **抑揚（将来的）**:
  - 音声のピッチ変化
  - 単調さの検出

**使用技術**:
- AWS Transcribe（書き起こし + タイムスタンプ）
- pydub（音声処理）

#### 3. 内容分析エージェント (Content Analyzer)
**役割**: 話の内容・構成の分析
- **話の流れ・構成**:
  - イントロ → 本題 → まとめの構成
  - 論理的な繋がり
  - トピックの遷移の自然さ
- **言葉遣い**:
  - 専門用語の適切な使用
  - わかりやすい表現
  - 繰り返しや冗長性
- **時間配分**:
  - 各セクションの時間バランス
  - 全体の長さ

**使用技術**:
- Claude 3.5 Sonnet（書き起こしテキストの分析）

### Phase 2以降: 拡張エージェント（音声→動画対応時）

#### 4. 視覚分析エージェント (Visual Analyzer) ※Phase 2
**役割**: 映像からの視覚情報分析
- ジェスチャー・ボディランゲージ
- 表情・自信
- 画面構成

**使用技術**:
- ffmpeg（動画から音声抽出）
- Claude Vision（動画フレーム分析）

#### 5. スライド分析エージェント (Slide Analyzer) ※Phase 3
**役割**: スライドとの同期分析
- スライド切り替えタイミング
- スライドと発言の整合性

## システムフロー

### Phase 1: 音声ベース
```
[音声ファイル入力]
    ↓
[前処理]
    ├─ AWS Transcribe で書き起こし（タイムスタンプ付き）
    └─ 音声ファイルの基本情報取得（長さ等）
    ↓
[並列分析]
    ├─ 音声特徴分析エージェント
    │   └─ 話すスピード、フィラーワード、間の分析
    └─ 内容分析エージェント
        └─ 構成、言葉遣い、論理性の分析
    ↓
[監督者エージェント]
    └─ 統合レポート生成
    ↓
[出力]
    ├─ よかった点 Top 3-5
    ├─ 改善点 Top 3-5
    └─ 観点別詳細フィードバック
```

### Phase 2: 動画対応（拡張時）
```
[動画ファイル入力]
    ↓
[前処理]
    ├─ ffmpeg で音声抽出 ← Phase 1の処理に流す
    └─ フレーム抽出（キーフレーム）
    ↓
[Phase 1の処理] + [視覚分析エージェント]
```

**拡張性**: 音声処理部分は共通化されており、入力が動画になっても音声抽出のステップを追加するだけ。

## 技術スタック

### AWS Bedrock
**Phase 1で使用するLLM**:
- **Amazon Nova Lite**: 音声特徴分析・内容分析（コスト効率重視の定性評価）
- **Claude（最新の高性能モデル）**: 監督者エージェント（高品質な統合判断・最終レポート生成）
  - モデル選択の優先順位: Claude 4.5 Sonnet → Claude 4 Sonnet → Claude 3.7 Sonnet → Claude 3.5 Sonnet
  - 利用可能な最も性能の高いモデルを自動選択

**Phase 2以降**:
- Claude Vision: 動画フレーム分析

### 音声処理
- AWS Transcribe: 音声書き起こし
- pydub: 音声ファイル操作（将来的）

### その他
- Strands Agents: マルチエージェント基盤
- Streamlit: UI（Web版）
- boto3: AWS SDK

## MVP（最小実装）の優先順位

### Phase 1: 音声ベースMVP（最優先）
1. ✅ AWS Transcribe による書き起こし（タイムスタンプ付き）
2. ✅ 音声特徴分析エージェント
   - 話すスピード計測
   - フィラーワード検出
3. ✅ 内容分析エージェント
   - 話の構成分析
   - 言葉遣い・わかりやすさ
4. ✅ 監督者エージェント（統合レポート生成）

**成果物**: 音声ファイルを入力すると、よかった点・改善点を含むフィードバックレポートが出力される

### Phase 2: 動画対応
5. 🔲 動画からの音声抽出（ffmpeg）
6. 🔲 視覚分析エージェント（Claude Vision）
   - 表情・ジェスチャー分析
7. 🔲 音声の抑揚分析（高度な音声特徴量）

### Phase 3: 高度な分析
8. 🔲 スライド入力対応
9. 🔲 スライドと発表の同期分析
10. 🔲 スコアリング機能
11. 🔲 過去の発表との比較・成長分析

## UI/フロントエンド戦略

### Phase 1: CLI + Streamlit
**最もシンプル・開発コスト低**

#### CLI版
```bash
$ python cli.py analyze /path/to/audio.mp3

=== プレゼンフィードバックレポート ===
総時間: 8分32秒

【よかった点】
1. 話すスピードが適切 (320文字/分)
2. 構成がしっかりしている（イントロ→本題→まとめ）
3. 専門用語に説明が付いていてわかりやすい

【改善点】
1. フィラーワード「えー」が多い（24回）
   → 意識的に減らすか、ポーズに置き換える
2. 後半のペースが速い
   → 重要な部分はゆっくり話す
```

#### Streamlit版
- ブラウザで使える
- ファイルアップロードが簡単
- 視覚的に見やすい
- 実装コスト低（Pythonのみ）

### Phase 2: React/Next.js（本格化）
必要に応じて本格的なWebアプリに移行

## 音声から動画への拡張性

### 設計上の利点
1. **処理の共通化**: 動画も最終的に音声抽出して同じパイプラインを通す
2. **段階的な開発**: まず音声で完成させ、動画は入力処理の追加のみ
3. **コスト削減**: 音声のみで十分な分析が可能（視覚は付加価値）

### 動画対応時の追加実装
```python
# 動画から音声抽出（追加するだけ）
def extract_audio_from_video(video_path: str) -> str:
    """動画から音声を抽出してaudio_pathを返す"""
    audio_path = video_path.replace('.mp4', '.mp3')
    # ffmpeg処理
    return audio_path

# 既存の音声処理パイプラインに流す
audio_path = extract_audio_from_video(video_path)
analyze_presentation(audio_path)  # 既存の関数
```

**結論**: 音声ベースで設計しても、動画対応は容易。むしろ音声で完成度を高めてから拡張する方が効率的。

## 検討事項

### 1. 音声/動画の入力方法
- **Phase 1**: ローカルファイルパス（音声ファイル）
- **Phase 2**: 動画ファイル → ffmpegで音声抽出
- **共通**: S3アップロード対応も検討（大容量ファイル対応）

### 2. 処理時間
- AWS Transcribeの処理時間（非同期処理）
- 長時間の音声の場合の考慮

### 3. コスト
- AWS Transcribe: 従量課金（秒単位）
- Claude API呼び出し: 書き起こしテキストの長さに依存
- 想定: 10分の発表で数十円程度

### 4. プライバシー
- 音声データの取り扱い
- 一時ファイルの削除
- S3バケットのライフサイクル設定
